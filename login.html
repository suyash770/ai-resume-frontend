<div class="login-card">
    <h1 id="formTitle">ATS Login</h1>
    
    <div class="form-group">
        <label>Select Role</label>
        <select id="userRole">
            <option value="hr">HR Panel</option>
            <option value="admin">Admin Panel</option>
            <option value="candidate">Candidate Panel</option>
        </select>
    </div>

    <div id="signupFields" style="display:none;">
        <div class="form-group">
            <label>Username</label>
            <input type="text" id="regName">
        </div>
        <div class="form-group">
            <label>Mobile</label>
            <input type="tel" id="regMobile">
        </div>
    </div>

    <div class="form-group">
        <label>Email ID</label>
        <input type="email" id="userEmail">
    </div>
    <div class="form-group">
        <label>Password</label>
        <input type="password" id="userPass">
    </div>

    <button id="authBtn" onclick="handleAuth()" class="login-btn">Login</button>
    
    <p style="text-align:center; margin-top:1rem; font-size:0.8rem; cursor:pointer; color:#7c3aed;" 
       onclick="toggleAuthMode()" id="toggleText">Don't have an account? Sign Up</p>
</div>

<script>
let isLoginMode = true;

function toggleAuthMode() {
    isLoginMode = !isLoginMode;
    document.getElementById("formTitle").innerText = isLoginMode ? "ATS Login" : "Create Account";
    document.getElementById("authBtn").innerText = isLoginMode ? "Login" : "Register";
    document.getElementById("signupFields").style.display = isLoginMode ? "none" : "block";
    document.getElementById("toggleText").innerText = isLoginMode ? "Don't have an account? Sign Up" : "Already have an account? Login";
}

async function handleAuth() {
    const role = document.getElementById("userRole").value;
    const email = document.getElementById("userEmail").value;
    const pass = document.getElementById("userPass").value;

    if (isLoginMode) {
        // LOGIN LOGIC: Verify against database
        const response = await fetch(`https://ai-resume-backend-w44h.onrender.com/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, pass, role })
        });
        const result = await response.json();

        if (response.ok) {
            localStorage.setItem("userSession", JSON.stringify(result.user));
            window.location.href = result.redirect;
        } else {
            alert(result.error);
        }
    } else {
        // SIGNUP LOGIC: Save to database
        const name = document.getElementById("regName").value;
        const mobile = document.getElementById("regMobile").value;
        
        const response = await fetch(`https://ai-resume-backend-w44h.onrender.com/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, mobile, pass, role })
        });
        
        if (response.ok) {
            alert("Registration successful! Please login.");
            toggleAuthMode();
        }
    }
}
</script>